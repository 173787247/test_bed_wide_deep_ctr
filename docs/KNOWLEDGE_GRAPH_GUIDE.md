# 知识图谱功能使用指南

## 概述

知识图谱功能基于LLM的NER技术，从文档中提取实体和关系，构建知识图谱，并提供基于图谱的智能检索。

## 功能特点

### 🧠 基于LLM的NER
- 使用Ollama本地大语言模型进行命名实体识别
- 支持多种实体类型：人物、地点、组织、概念、技术、产品、事件
- 支持多种关系类型：属于、位于、开发、使用、相关、影响

### 🕸️ 知识图谱构建
- 使用NetworkX构建有向多重图
- 支持实体和关系的存储、查询和可视化
- 自动去重和合并相似实体

### 🔍 智能检索
- **纯图谱检索**: 基于实体匹配和图距离的检索
- **混合检索**: 结合传统TF-IDF和知识图谱的检索
- **实体扩展**: 通过相关实体扩展检索结果

## 使用流程

### 1. 构建知识图谱

1. 进入 **"🏗️ 第一部分：离线索引构建"** 标签页
2. 选择 **"🕸️ 知识图谱"** 子标签页
3. 选择NER模型（推荐llama3.1:8b）
4. 点击 **"🔨 构建知识图谱"** 按钮
5. 等待构建完成（需要一定时间）

### 2. 查看图谱统计
- 点击 **"📊 刷新统计"** 查看：
  - 实体数量
  - 关系数量
  - 实体类型分布
  - 关系类型分布

### 3. 实体搜索
- 在实体搜索框中输入关键词
- 查看匹配的实体列表
- 包含实体名称、类型、描述、文档数量等信息

### 4. 图谱检索测试
- 输入查询语句
- 选择检索模式：
  - **knowledge_graph**: 纯知识图谱检索
  - **hybrid**: 混合检索（推荐）
- 查看检索结果和检索原因

### 5. 使用RAG系统
- 进入 **"🤖 第三部分：RAG问答系统"** 标签页
- 构建知识图谱后，RAG系统会自动使用图谱信息
- 提供更准确的问答结果

## 技术实现

### NER流程
1. **文档分段**: 长文档自动分段处理
2. **LLM提取**: 使用Ollama进行实体关系提取
3. **JSON解析**: 解析LLM返回的结构化数据
4. **去重合并**: 自动去重和合并相似实体

### 图谱构建
```python
# 实体存储
graph.add_node(entity_name, 
              entity_type=type,
              description=desc,
              doc_count=count)

# 关系存储
graph.add_edge(subject, object,
              predicate=relation_type,
              description=desc)
```

### 检索算法
1. **实体匹配**: 查找查询中的相关实体
2. **图遍历**: 基于图距离查找相关实体
3. **文档聚合**: 收集相关实体的文档
4. **分数计算**: 基于实体匹配度和图距离计算分数

## 高级功能

### 混合检索
- 结合传统TF-IDF和知识图谱检索
- 可调整权重平衡两种检索方式
- 提供更全面的检索结果

### 实体关系分析
- 查看实体的出入关系
- 分析实体间的连接路径
- 支持多跳关系查询

### 图谱导出
- 支持JSON格式导出
- 包含完整的实体和关系信息
- 便于数据分析和可视化

## 使用建议

### 模型选择
- **llama3.1:8b**: 平衡性能和效果，推荐使用
- **qwen2.5:7b**: 中文优化，适合中文文档
- **llama3.2:1b**: 速度快，适合快速测试

### 性能优化
- 图谱构建是CPU密集型任务，建议在性能较好的机器上运行
- 大量文档建议分批处理
- 定期保存图谱避免重复构建

### 质量提升
- 确保文档质量，避免过多噪声
- 定期检查和清理图谱
- 根据需要调整NER提示词

## 故障排除

### 常见问题
1. **构建失败**: 检查Ollama服务状态
2. **实体提取不准确**: 尝试更换模型或调整提示词
3. **检索结果为空**: 确认图谱已构建且包含相关实体

### 性能问题
- 构建时间过长：使用更小的模型或减少文档数量
- 检索响应慢：优化图谱结构或增加缓存

## 扩展功能

### 自定义实体类型
- 可以修改NER提示词支持特定领域的实体类型
- 支持自定义关系类型

### 图谱可视化
- 提供可视化数据接口
- 支持第三方图谱可视化工具

### 实时更新
- 支持增量更新图谱
- 新增文档自动提取实体关系

## 注意事项

1. 知识图谱构建需要较长时间，请耐心等待
2. 图谱质量依赖于文档质量和NER模型性能
3. 建议先在小规模数据上测试，确认效果后再大规模使用
4. 定期备份图谱数据，避免意外丢失 